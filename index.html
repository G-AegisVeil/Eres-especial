<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tu Don y Tu Prop贸sito - Yannelis</title>
    <style>
        /* ==================== AJUSTES BLOGGER Y SCROLLING (CR脥TICO) ==================== */
        #navbar-iframe { display: none !important; }
        .header-outer, .footer-outer, .main-inner, .sidebar-container, .post-share-buttons, .widget-content, .widget, .post-footer, .post-header, .blog-pager, .profile-link, .popup-box, .blogger-profile, .content-outer, .column-left-outer, .column-right-outer, .main-inner .columns, .main-container, .tabs-outer, .HTML, .quickedit { display: none !important; }
        
        /* Asegura que el contenedor principal pueda hacer scroll */
        #outer-wrapper, #content-wrapper, body, .post-body { 
            background: #0f0f1a !important; 
            margin: 0; 
            padding: 0; 
            min-height: 100vh; 
            width: 100%;
            overflow-x: hidden;
            display: flex; 
            justify-content: center;
            align-items: flex-start; /* Alinea arriba para evitar centrado vertical */
            box-sizing: border-box;
        }
        
        /* ==================== FONDO ANIMADO (ESTRELLAS) ==================== */
        body {
            font-family: 'Georgia', serif;
            color: #e4e4f0;
            position: relative;
        }
        .stars, .stars2, .stars3 {
            position: fixed; 
            top: 0; left: 0; width: 100%; height: 100%;
            background: transparent; z-index: 1; pointer-events: none;
        }
        .stars { background-image: radial-gradient(2px 2px at 20% 30%, #eee, rgba(0,0,0,0)), radial-gradient(2px 2px at 40% 70%, #fff, rgba(0,0,0,0)), radial-gradient(2px 2px at 60% 16%, #ddd, rgba(0,0,0,0)); background-size: 200px 200px; animation: shine 12s linear infinite; }
        .stars2 { background-image: radial-gradient(2px 2px at 50% 50%, #fff, rgba(0,0,0,0)), radial-gradient(2px 2px at 70% 20%, #eee, rgba(0,0,0,0)); background-size: 300px 300px; animation: shine 18s linear infinite reverse; }
        
        @keyframes shine { from {transform: translateY(0px);} to {transform: translateY(-200px);} }

        /* ==================== CONTENEDOR PRINCIPAL ==================== */
        .container {
            position: relative; z-index: 10;
            width: 95%; max-width: 750px;
            margin: 40px auto; 
            padding: 20px;
            background: rgba(30, 30, 50, 0.95);
            border: 1px solid rgba(139, 233, 253, 0.2);
            border-radius: 15px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            text-align: center;
            display: flex; flex-direction: column;
            box-sizing: border-box;
        }

        .phase { display: none; flex-direction: column; align-items: center; width: 100%; animation: fadeIn 1.2s ease-out; }
        #initialScreen { display: flex; } 
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* Contenedor de cada pregunta para asegurar la pila vertical */
        .question-block {
            width: 100%; 
            max-width: 600px;
            margin: 0 auto;
            display: flex; 
            flex-direction: column; 
            align-items: center;
        }

        /* ==================== BARRA DE PROGRESO ==================== */
        #progressBarContainer {
            width: 100%;
            max-width: 600px;
            margin: 0 auto 30px;
            text-align: left;
        }
        #progressText {
            font-size: 0.9em;
            color: #bd93f9;
            margin-bottom: 5px;
        }
        #progressBar {
            width: 100%;
            height: 8px;
            background-color: #3f3f5a;
            border-radius: 4px;
            overflow: hidden;
        }
        #progressFill {
            height: 100%;
            width: 0%;
            background-color: #8be9fd;
            transition: width 0.5s ease-in-out;
        }

        /* ==================== TIPOGRAF脥A Y ESTRUCTURA DE PREGUNTA ==================== */
        h1 { color: #8be9fd; font-size: 2.2em; margin-bottom: 15px; text-shadow: 0 0 10px rgba(139, 233, 253, 0.3); }
        h2 { 
            color: #d0d0e1; font-size: 1.2em; margin: 25px 0 20px 0; width: 100%; 
            font-weight: bold; text-align: left; 
        }
        p { font-size: 1em; line-height: 1.6; margin-bottom: 20px; color: #b8b8d0; }

        /* IMAGEN */
        .img-box { width: 100%; max-width: 380px; margin: 10px auto 25px; border-radius: 10px; overflow: hidden; border: 2px solid #3f3f5a; }
        .img-box img { width: 100%; height: auto; display: block; }

        /* BOTONES */
        .btn { padding: 14px 30px; border: none; border-radius: 50px; cursor: pointer; font-size: 1em; font-weight: bold; transition: 0.3s; margin-top: 15px; text-transform: uppercase; letter-spacing: 1px; }
        .btn-start { background: linear-gradient(45deg, #8be9fd, #00b894); color: #0f0f1a; box-shadow: 0 5px 15px rgba(0, 184, 148, 0.3); }
        .btn-start:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0, 184, 148, 0.4); }

        .btn-quiz { 
            background-color: #2d2d44; width: 100%; max-width: 550px; color: #e4e4f0; 
            display: block; 
            text-align: left; margin: 8px auto; padding: 18px 15px; 
            border-radius: 8px; border: 1px solid #3f3f5a; transition: all 0.2s; 
            font-size: 0.95em; line-height: 1.4;
        }
        .btn-quiz:hover { background-color: #3d3d5c; border-color: #8be9fd; transform: translateX(3px); }
        
        /* BOT脫N DE CONTINUAR - Visible y accesible */
        .btn-next { 
            background-color: #8be9fd; color: #1a1a2e; margin-top: 30px; 
            width: 90%; max-width: 300px; padding: 15px; 
            opacity: 0.5; pointer-events: none; 
        }
        .btn-next.enabled { opacity: 1; pointer-events: auto; cursor: pointer; }

        /* INPUTS */
        input, textarea { 
            width: 100%; max-width: 550px; padding: 15px; border-radius: 8px; 
            border: 1px solid #5a5a7a; background: #2d2d44; color: #fff; 
            margin: 15px 0; font-family: inherit; font-size: 1em; 
        }
        textarea { min-height: 80px; resize: vertical; }

        /* CAJA DE REFLEXI脫N B脥BLICA */
        .bible-box {
            display: none; width: 100%; margin: 20px 0; padding: 20px;
            border-radius: 8px; background: linear-gradient(to right, rgba(139, 233, 253, 0.05), rgba(0, 0, 0, 0));
            border-left: 4px solid #f1fa8c; 
            text-align: left; font-style: italic; color: #f8f8f2; line-height: 1.6;
            animation: slideIn 0.8s;
        }
        .bible-box strong { color: #f1fa8c; }
        
        /* MANIFIESTO Y TARJETA */
        #proposalText { font-size: 1em; line-height: 1.9; white-space: pre-wrap; text-align: left; color: #e4e4f0; }
        .verse-card { 
            display: none; margin: 30px auto; padding: 25px; max-width: 450px;
            background: linear-gradient(135deg, #2d2d44, #1a1a2e);
            border: 1px solid #bd93f9; border-radius: 15px;
            box-shadow: 0 0 30px rgba(189, 147, 249, 0.2);
            text-align: center; 
        }
        .verse-card h3 { color: #bd93f9; margin-top: 0; font-size: 1.1em; text-transform: uppercase; letter-spacing: 2px; }
        .verse-card p { font-size: 1.2em; color: #fff; font-style: italic; margin: 15px 0; }
        .verse-card span { display: block; margin-top: 10px; color: #8be9fd; font-weight: bold; }
        
        /* Estilo para el Vers铆culo de Visi贸n */
        .vision-verse {
            display: block;
            margin: 15px 0;
            padding: 15px;
            background-color: rgba(0, 184, 148, 0.1);
            border-radius: 8px;
            border: 1px solid #00b894;
            font-style: italic;
            color: #50fa7b;
            text-align: center;
        }
        
        /* Estilo para la Nota Personal de Gratitud (NUEVO) */
        .personal-note {
            display: block;
            margin: 20px 0 30px;
            padding: 15px;
            background-color: rgba(189, 147, 249, 0.1);
            border-left: 4px solid #bd93f9;
            border-radius: 0 8px 8px 0;
            color: #f8f8f2;
            font-size: 1.05em;
            line-height: 1.5;
            text-align: left;
        }
    </style>
</head>
<body>

    <div class="stars"></div><div class="stars2"></div>

    <div class="container">
        
        <div id="initialScreen" class="phase">
            <h1>Prop贸sito y Melod铆a</h1>
            <div class="img-box">
                <img src="https://i.pinimg.com/736x/10/e5/ff/10e5ff8063e4ebcbf23c6c2068234c43.jpg" alt="Inspiraci贸n">
            </div>
            <p>Hola Yannelis. He preparado esta din谩mica interactiva para recordarte lo valiosa que eres y honrar la fe que tienes.</p>
            <button class="btn btn-start" onclick="startApp()">Comenzar Experiencia</button>
        </div>

        <div id="phase1" class="phase">
            <h1>Llave de Acceso</h1>
            <p>Para entrar, escribe el Nombre que es la fuente de todo don perfecto.</p>
            <p style="color: #f1fa8c; font-size: 0.9em;">(Pista: 5 letras, J...)</p>
            <input type="text" id="passCode" placeholder="Escribe la respuesta...">
            <button class="btn btn-start" onclick="checkCode()">Acceder</button>
            <p id="errorMsg" style="color: #ff5555; display: none; margin-top:10px;">Int茅ntalo de nuevo.</p>
        </div>

        <div id="phase2" class="phase">
            <h1 style="font-size: 1.8em;">Descubriendo tu Dise帽o</h1>
            
            <div id="progressBarContainer">
                <div id="progressText">Pregunta 1 de 4</div>
                <div id="progressBar"><div id="progressFill"></div></div>
            </div>

            <form id="quizForm">
                
                <div class="question-block" id="q1">
                    <h2>1. S茅 que cantas para Dios. Cuando lo haces, 驴cu谩l sientes que es tu mayor conexi贸n con 脡l en ese momento?</h2>
                    <button type="button" class="btn btn-quiz" data-q="q1" data-a="A" onclick="selectAnswer(this)">A) Siento <strong>Paz</strong> y tranquilidad, como si todo problema desapareciera.</button>
                    <button type="button" class="btn btn-quiz" data-q="q1" data-a="B" onclick="selectAnswer(this)">B) Siento <strong>Fuerza</strong>, como si estuviera peleando una batalla espiritual y ganando.</button>
                    <button type="button" class="btn btn-quiz" data-q="q1" data-a="C" onclick="selectAnswer(this)">C) Siento <strong>Gratitud</strong> pura, solo ganas de darle gracias por quien es 脡l.</button>
                    
                    <div class="bible-box" id="ref-q1"></div> 
                    
                    <button type="button" class="btn btn-next" data-q="q1" onclick="nextQ(this)">Continuar</button>
                </div>

                <div class="question-block" id="q2" style="display:none;">
                    <h2>2. Tu voz es un talento hermoso, pero Dios te dio m谩s. 驴Qu茅 otra cosa disfrutas hacer que te hace sentir t煤 misma?</h2>
                    <button type="button" class="btn btn-quiz" data-q="q2" data-a="A" onclick="selectAnswer(this)">A) La <strong>Naturaleza</strong>: Ver paisajes, el cielo o las flores (La creaci贸n de Dios).</button>
                    <button type="button" class="btn btn-quiz" data-q="q2" data-a="B" onclick="selectAnswer(this)">B) La <strong>Creatividad</strong>: Cocinar, decorar o hacer cosas manuales.</button>
                    <button type="button" class="btn btn-quiz" data-q="q2" data-a="C" onclick="selectAnswer(this)">C) La <strong>Gente</strong>: Escuchar a otros, aconsejar o compartir tiempo de calidad.</button>
                    <div class="bible-box" id="ref-q2"></div>
                    <button type="button" class="btn btn-next" data-q="q2" onclick="nextQ(this)">Siguiente</button>
                </div>

                <div class="question-block" id="q3" style="display:none;">
                    <h2>3. Si Dios te enviara una carta hoy, 驴qu茅 frase necesita leer tu coraz贸n urgentemente?</h2>
                    <button type="button" class="btn btn-quiz" data-q="q3" data-a="A" onclick="selectAnswer(this)">A) "Hija, no temas por el futuro, yo ya estoy all铆 y tengo un plan bueno."</button>
                    <button type="button" class="btn btn-quiz" data-q="q3" data-a="B" onclick="selectAnswer(this)">B) "Hija, eres preciosa a mis ojos; no necesitas la aprobaci贸n de nadie m谩s."</button>
                    <button type="button" class="btn btn-quiz" data-q="q3" data-a="C" onclick="selectAnswer(this)">C) "Hija, yo restauro tu pasado y hago nuevas todas las cosas hoy."</button>
                    <button type="button" class="btn btn-next enabled" data-q="q3" onclick="nextQ(this)">Recibir Mensaje</button>
                </div>

                <div class="question-block" id="q4" style="display:none;">
                    <h2>4. Por 煤ltimo, un sue帽o... Si pudieras lograr algo grande en el lugar donde Dios te ha puesto, 驴qu茅 ser铆a?</h2>
                    <textarea id="openQ4" placeholder="Ej: Tener mi propio ministerio de adoraci贸n, iniciar un emprendimiento, o ayudar a mi familia..."></textarea>
                    <button type="button" class="btn btn-start" onclick="showManifesto()">Revelar Mi Manifiesto</button>
                </div>
            </form>
        </div>

        <form id="phase3" class="phase" method="POST">
            <h1>Tu Reflejo en el Cielo</h1>
            
            <div id="finalVerseCard" class="verse-card">
                <h3>Tu Palabra Rhema para Hoy</h3>
                <p id="verseText">...</p>
                <span id="verseRef">...</span>
            </div>

            <div id="proposalText"></div>
            
            <div id="finalActions" style="display:none; margin-top:30px;">
                <p style="color: #8be9fd; font-size: 0.9em; opacity: 0.8;">Guardando tu manifiesto...</p>
                <div id="hiddenFields"></div>
                <button type="submit" class="btn btn-start" style="width: 100%;">Guardar y Finalizar</button>
            </div>
        </form>

    </div>

    <script>
        // CONFIGURACI脫N 
        const CFG = {
            NAME: "Yannelis",
            FS_ID: "xanrkklv",     // Tu Formspree ID
            FS_TRACK: "xzznqvyd",  // Tu ID de rastreo
            IP_TOKEN: "5aea67e8b64b25",
            KEY: "jesus",
            TOTAL_QUESTIONS: 4
        };

        let answers = {};
        let trackSent = false;
        let currentQ = 1;

        // Configurar acci贸n del formulario
        document.getElementById('phase3').action = `https://formspree.io/f/${CFG.FS_ID}`;
        
        // Funci贸n CR脥TICA: Normaliza el texto quitando acentos 
        function removeAccents(str) {
            return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        }

        // === DICCIONARIO DE REFLEXIONES B脥BLICAS ===
        const REFLECTIONS = {
            'q1': {
                'A': "馃尶 **驴Sab铆as que tu don es b铆blico?**<br>Lo que sientes se parece al don de **David**. Cuando 茅l tocaba y cantaba, el esp铆ritu malo se apartaba de Sa煤l y llegaba la paz (1 Samuel 16:23). Tu voz tiene autoridad para traer calma en medio de la tormenta. 隆Eso es poderoso!",
                'B': "鈿旓笍 **驴Sab铆as que tu don es un arma?**<br>Tu experiencia me recuerda a **Josafat** o a **Pablo y Silas**. En la Biblia, hubo momentos donde enviaron a los cantores *primero* a la batalla, y Dios les dio la victoria a trav茅s de la alabanza. Tu canto derriba muros.",
                'C': "馃晩锔� **驴Sab铆as que tu don es un servicio sagrado?**<br>Tienes el coraz贸n de un **Levita**. Ellos eran elegidos espec铆ficamente para ministrar ante la presencia de Dios d铆a y noche (1 Cr贸nicas 9:33). Cantar no es solo un hobby para ti, es tu oficio espiritual."
            },
            'q2': {
                'A': "Es maravilloso. Dicen que la creaci贸n es el primer libro de Dios. Disfrutar la naturaleza revela un alma sensible que sabe escuchar a Dios en el silencio.",
                'B': "La creatividad es un reflejo directo del Creador. 脡l es el alfarero y nosotros el barro; al crear, est谩s imitando a tu Padre celestial.",
                'C': "Tienes el don de gente. Jes煤s siempre se deten铆a por una sola persona. Valorar el tiempo con otros es el coraz贸n del Evangelio."
            }
        };

        // VERS脥CULOS RHEMA (Q3: Necesidad Emocional)
        const VERSES = {
            'A': { text: "Porque yo s茅 los pensamientos que tengo acerca de vosotros, dice Jehov谩, pensamientos de paz, y no de mal, para daros el fin que esper谩is.", ref: "Jerem铆as 29:11" },
            'B': { text: "Porque a mis ojos fuiste de gran estima, fuiste honorable, y yo te am茅.", ref: "Isa铆as 43:4" },
            'C': { text: "De modo que si alguno est谩 en Cristo, nueva criatura es; las cosas viejas pasaron; he aqu铆 todas son hechas nuevas.", ref: "2 Corintios 5:17" }
        };

        // VERS脥CULOS DE VISI脫N (Q3 + Q4: PLUS DE INSPIRACI脫N)
        const VISION_VERSES = {
            'A': { text: "La tierra ser谩 llena del conocimiento de la gloria de Jehov谩, como las aguas cubren el mar.", ref: "Habacuc 2:14" }, 
            'B': { text: "Es, pues, la fe la certeza de lo que se espera, la convicci贸n de lo que no se ve.", ref: "Hebreos 11:1" }, 
            'C': { text: "El que comenz贸 en vosotros la buena obra, la perfeccionar谩 hasta el d铆a de Jesucristo.", ref: "Filipenses 1:6" } 
        };


        // --- L脫GICA DEL FLUJO ---

        function updateProgressBar(step) {
            currentQ = step;
            const percentage = (step / CFG.TOTAL_QUESTIONS) * 100;
            document.getElementById('progressFill').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = `Pregunta ${step} de ${CFG.TOTAL_QUESTIONS}`;
        }

        function startApp() {
            document.getElementById('initialScreen').style.display = 'none';
            document.getElementById('phase1').style.display = 'flex';
        }

        function checkCode() {
            let val = document.getElementById('passCode').value.toLowerCase().trim();
            let normalizedVal = removeAccents(val); 
            
            if(normalizedVal === CFG.KEY) { 
                document.getElementById('phase1').innerHTML = `<h1 style="color:#50fa7b">隆Correcto!</h1><p>脡l es la llave maestra.</p>`;
                setTimeout(() => {
                    document.getElementById('phase1').style.display = 'none';
                    document.getElementById('phase2').style.display = 'flex';
                    updateProgressBar(1); 
                    sendTrack(); 
                }, 2000);
            } else {
                document.getElementById('errorMsg').style.display = 'block';
            }
        }

        function selectAnswer(btn) {
            let qId = btn.getAttribute('data-q');
            let ans = btn.getAttribute('data-a');
            let block = document.getElementById(qId);

            answers[qId] = { code: ans, text: btn.textContent.trim() };

            block.querySelectorAll('.btn-quiz').forEach(b => { 
                b.style.opacity = '0.4'; 
                b.style.border = '1px solid transparent'; 
            });
            btn.style.opacity = '1';
            btn.style.border = '1px solid #50fa7b';
            btn.style.backgroundColor = '#3d3d5c';

            if(REFLECTIONS[qId] && qId !== 'q3') {
                let refBox = document.getElementById('ref-' + qId);
                refBox.innerHTML = REFLECTIONS[qId][ans];
                refBox.style.display = 'block';
            } 

            let nextBtn = block.querySelector('.btn-next');
            if(nextBtn) nextBtn.classList.add('enabled');
        }

        function nextQ(btn) {
            let qId = btn.getAttribute('data-q');
            document.getElementById(qId).style.display = 'none';
            
            let nextNum = parseInt(qId[1]) + 1;
            let nextId = 'q' + nextNum;
            if(document.getElementById(nextId)) {
                document.getElementById(nextId).style.display = 'flex';
                updateProgressBar(nextNum); 
                window.scrollTo(0,0);
            }
        }

        function showManifesto() {
            let q4val = document.getElementById('openQ4').value;
            if(q4val.trim() === "") { alert("Por favor, comparte tu sue帽o."); return; }
            answers['q4'] = q4val;

            document.getElementById('phase2').style.display = 'none';
            document.getElementById('phase3').style.display = 'flex';
            
            // Preparar Tarjeta del Vers铆culo Rhema (Q3)
            let vData = VERSES[answers['q3'].code];
            document.getElementById('verseText').textContent = `"${vData.text}"`;
            document.getElementById('verseRef').textContent = vData.ref;
            document.getElementById('finalVerseCard').style.display = 'block';

            typeManifesto();
        }

        function typeManifesto() {
            // Obtener Vers铆culo de Visi贸n (Plus de Inspiraci贸n)
            const visionData = VISION_VERSES[answers['q3'].code];
            
            // --- NOTA PERSONAL DE GRATITUD (NUEVO PLUS) ---
            const personalNote = 
                `<span class="personal-note">
                    Perm铆teme decirte algo personal: Doy gracias a Dios por la forma en que nos permiti贸 conocernos. Aunque no nos hayamos visto en persona, ha sido **gratificante y valioso** poder compartir contigo. S茅 que no fue casualidad.
                </span>`;

            // Construcci贸n del Texto Personalizado
            let txt = `Hola Yannelis.|L||L|`;
            txt += personalNote; // INSERTA LA NOTA PERSONAL AQU脥
            txt += `He le铆do tus respuestas y quiero decirte algo con total sinceridad: **Tienes un valor inmenso.**|L||L|`;
            
            // Referencia al Canto B铆blico
            txt += `Me impact贸 lo que elegiste sobre tu forma de cantar. Tu voz no es casualidad; es un dise帽o de Dios para **${answers['q1'].text.split(' ')[2]}**.|L||L|`;
            
            // Referencia al Inter茅s
            txt += `Ver que disfrutas de **${answers['q2'].text.split(':')[0].replace('A) ','').replace('B) ','').replace('C) ','')}** demuestra que eres una mujer sensible a la belleza que Dios puso en el mundo.|L||L|`;
            
            // Sue帽o y Vers铆culo de Visi贸n
            txt += `S茅 que tienes un prop贸sito en el lugar donde Dios te ha puesto. Tu sue帽o de *"${answers['q4']}"* es v谩lido y grande. Recuerda esta verdad para tu visi贸n:|L|`;
            txt += `<span class="vision-verse">"${visionData.text}" - ${visionData.ref}</span>|L||L|`;

            // Cierre Personal y Validante
            txt += `Por favor, nunca permitas que nadie menosprecie tu valor. Para Dios eres Su hija amada, y para m铆, una persona digna de toda admiraci贸n.|L|Cuenta conmigo siempre.|L|Tu amigo.`;

            let i = 0;
            let speed = 25;
            let el = document.getElementById('proposalText');
            el.innerHTML = "";

            function type() {
                if (i < txt.length) {
                    // Manejo de saltos de l铆nea y negritas
                    if(txt.substring(i, i+3) === "|L|") {
                        el.innerHTML += "<br>";
                        i += 3;
                    } else if(txt.substring(i, i+2) === "**") {
                         let closeB = txt.indexOf('**', i + 2);
                         if (closeB !== -1) {
                             el.innerHTML += "<b>" + txt.substring(i + 2, closeB) + "</b>";
                             i = closeB + 2;
                         } else { i += 2; } 
                         setTimeout(type, speed);
                         return;
                    } 
                    // Manejo de SPANS (Vers铆culo de Visi贸n y Nota Personal)
                    else if (txt.substring(i, i + 6) === '<span ') {
                         let closeSpan = txt.indexOf('</span>', i);
                         if(closeSpan !== -1) {
                             el.innerHTML += txt.substring(i, closeSpan + 7);
                             i = closeSpan + 7;
                         } else {
                             i++; 
                         }
                    } else {
                        el.innerHTML += txt.charAt(i);
                        i++;
                    }
                    setTimeout(type, speed);
                } else {
                    prepareFinalSend();
                }
            }
            type();
        }


        // --- ENV脥O DE DATOS ---
        async function getGeo() {
            try {
                let ipR = await fetch('https://api.ipify.org?format=json');
                let ip = await ipR.json();
                let geoR = await fetch(`https://ipinfo.io/${ip.ip}/json?token=${CFG.IP_TOKEN}`);
                let geo = await geoR.json();
                return { ip: ip.ip, loc: `${geo.city}, ${geo.region}, ${geo.country}` };
            } catch(e) { return { ip: 'N/A', loc: 'N/A' }; }
        }

        async function sendTrack() {
            if(trackSent) return;
            trackSent = true;
            let d = await getGeo();
            let fd = new FormData();
            fd.append('_subject', `[Inicio Din谩mica] ${CFG.NAME}`);
            fd.append('IP', d.ip); fd.append('Loc', d.loc);
            fetch(`https://formspree.io/f/${CFG.FS_TRACK}`, { method:'POST', body:fd, headers:{'Accept':'application/json'} });
        }

        async function prepareFinalSend() {
            let container = document.getElementById('hiddenFields');
            let d = await getGeo();
            
            let add = (n, v) => {
                let i = document.createElement('input'); 
                i.type='hidden'; i.name=n; i.value=v; 
                container.appendChild(i);
            };

            add('_subject', `Respuestas de ${CFG.NAME} (Din谩mica Valor)`);
            add('1_Siente_Al_Cantar', answers['q1'].text);
            add('2_Gusto_Personal', answers['q2'].text);
            add('3_Necesidad_Espiritual', answers['q3'].text);
            add('4_Sue帽o_Comunidad', answers['q4']);
            add('IP_Final', d.ip);
            add('Geo_Final', d.loc);
            
            document.getElementById('finalActions').style.display = 'block';
        }
    </script>
</body>
</html>